<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <script src='node_modules/jquery/dist/jquery.js'></script>
    <script src='node_modules/bootstrap/dist/js/bootstrap.min.js'></script>

</head>

<body>
    <p>cryptonite
    </p>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="index.html">home</a>
        <a class="navbar-brand" href="index2.html">graphs</a>
        <a class="navbar-brand" href="#">Navbar</a>
        <input type="text" id="searchinput" placeholder="Insert Coin" class="form-control mr-sm-2">
        <button class="btn btn-outline-primary my-2 my-sm-0 mr-1" type="submit" id="search">Search</button>
        <img class="float-right" src="logo.png" width="110">


    </nav>
    <div id="chartContainer" style="height: 370px; width: 100%;"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <img src="gif.gif" id="gif">
            </div>
        </div>
    </div>
    <button id="check-btn">check list</button>

    <div class="container">
        <div id="All" class="row"></div>
    </div>
    <script>var firsttemplate = `  
            <div class="col-md-4 mb-2" >
                <div class="card" style="width: 13.5rem;">
                        <label class="switch float-right">
                        <input id="{{id}}" type="checkbox" class="checkbox" onclick="check()">
                        <span class="slider round"></span>
                    </label>
                <div>{{symbol}}</div>
                <div>{{name}}</div>
                <button type="button" id='btn' class="btn btn-primary" data-toggle="collapse" data-target="#cl{{id}}">More Info</button>
            </div>
            <div class="collapse" id="cl{{id}}">
  <div class="card card-body">
  </div>
</div>
</div>`
        const secondTemplate = `<img src="{{img}}" id="img">
        <div>$ {{data-usd}}</div>
        <div>€  {{data-eur}}</div>
        <div>₪ {{data-ils}}</div>
        <div>{{id}}</div>`;
        var arryofcoins = [];
        var res = [];
        $.ajax({
            url: 'bigdata.json',
            method: 'GET'
        }).done(function (s) {
            if (typeof s === 'string')
                s = JSON.parse(s);
            res = s;
            coincardbuilder(res);
            // console.log(typeof(res))
            console.log(res);
        })
        // "bigdata.json"
        function coincardbuilder(res) {
            $('#gif').show();
            $('#All').empty()
            let all = '';
            for (let i = 0; i < res.length; i++) {
                let t = firsttemplate;
                let o = i;
                t = t.replace('{{symbol}}', res[o].symbol);
                t = t.replace('{{name}}', res[o].name);
                t = t.replace(/{{id}}/g, res[o].id);
                all += t;
                $('#gif').hide();
            }
            $('#All').append(all);
            var res1 = [];
            $('.collapse').on('show.bs.collapse', function () {
                $('#gif').show();
                // move();
                // console.log("lasdk");
                var that = this;
                let newid = (that.id.replace('cl', ''));
                console.log(newid);
                $.ajax({
                    url: 'https://api.coingecko.com/api/v3/coins/' + newid,
                    method: 'GET'
                }).done(function (s) {
                    if (typeof s === 'string')
                        s = JSON.parse(s);
                    // res = s;
                    let t = secondTemplate;
                    console.log(s.market_data.current_price.usd);
                    $('#' + that.id + ' .card').empty();
                    t = t.replace('{{img}}', s.image.small);
                    t = t.replace('{{data-usd}}', s.market_data.current_price.usd);
                    t = t.replace('{{data-eur}}', s.market_data.current_price.eur);
                    t = t.replace('{{data-ils}}', s.market_data.current_price.ils);
                    t = t.replace('{{id}}', newid);
                    console.log(that.id)
                    $('#gif').hide();

                    $('#' + that.id + ' .card').append(t);
                });
                // $('#myProgress').empty()
            });

        }




        console.log(arryofcoins);
        // $(document).ready(function () {
        //     $('#btn').click(function () {
        //         $('.collapse').collapse('show');
        //     });
        // });
        $("#search").click(function (event) {
            $('#gif').show();
            console.log($('#searchinput').val());
            const v = $('#searchinput').val();
            const filteredArray = res.filter(c => c.id.indexOf(v.toLowerCase()) > -1)
            coincardbuilder(filteredArray);
            $('#gif').hide();
        });

        $('#check-btn').click(function () {
            alert('your list is: ' + arryofcoins);
        })
        function check() {
            checklist();
        }

        function checklist() {
            arryofcoins = [];
            for (let i = 0; i < res.length; i++) {
                if ($('#' + res[i].id).is(':checked')) {
                    arryofcoins.push(res[i].symbol.toUpperCase());

                }
            }
            if (arryofcoins.length > 5) {
                alert('sorry but you can chose only 5 coins');
                arryofcoins = [];
            }
            console.log(arryofcoins);
        }
        // <!-- 
        //      function move() {
        //   var elem = document.getElementById("myBar"); 
        //   var width = 10; 
        //   var id = setInterval(frame, 10);
        //   function frame() {
        //     if (width >= 100) {
        //       clearInterval(id);
        //     } else {
        //       width++; 
        //       elem.style.width = width + '%'; 
        //       elem.innerHTML = width * 1 + '%';
        //     }
        //   }
        // } -->
        window.onload = function () {

            var dataPoints1 = [];
            var dataPoints2 = [];
            var dataPoints3 = [];
            var dataPoints4 = [];
            var dataPoints5 = [];

            var options = {
                title: {
                    text: "Coins Graph"
                },
                axisX: {
                    title: "chart updates every 2 secs"
                },
                axisY: {
                    suffix: "Usd",
                    includeZero: false
                },
                toolTip: {
                    shared: true
                },
                legend: {
                    cursor: "pointer",
                    verticalAlign: "top",
                    fontSize: 22,
                    fontColor: "dimGrey",
                    itemclick: toggleDataSeries
                },
                data: [{
                    type: "line",
                    xValueType: "dateTime",
                    yValueFormatString: "###.00Wh",
                    xValueFormatString: "hh:mm:ss TT",
                    showInLegend: true,
                    name: "Turbine 1",
                    dataPoints: dataPoints1
                },
                {
                    type: "line",
                    xValueType: "dateTime",
                    yValueFormatString: "###.00Wh",
                    showInLegend: true,
                    name: "Turbine 2",
                    dataPoints: dataPoints2
                }, {
                    type: "line",
                    xValueType: "dateTime",
                    yValueFormatString: "###.00Wh",
                    showInLegend: true,
                    name: "Turbine 3",
                    dataPoints: dataPoints3
                }, {
                    type: "line",
                    xValueType: "dateTime",
                    yValueFormatString: "###.00Wh",
                    showInLegend: true,
                    name: "Turbine 4",
                    dataPoints: dataPoints4
                }, {
                    type: "line",
                    xValueType: "dateTime",
                    yValueFormatString: "###.00Wh",
                    showInLegend: true,
                    name: "Turbine 5",
                    dataPoints: dataPoints5
                }]
            };
            var chart = $("#chartContainer").CanvasJSChart(options);

            function toggleDataSeries(e) {
                if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                    e.dataSeries.visible = false;
                }
                else {
                    e.dataSeries.visible = true;
                }
                e.chart.render();
            }

            var updateInterval = 2000;
            // initial value
            var yValue1 = 800;
            var yValue2 = 810;
            var yValue3 = 790;
            var yValue4 = 780;
            var yValue5 = 820;

            var time = new Date();


            function updateChart(count) {
                count = count || 1;
                var deltaY1, deltaY2, deltaY3, deltaY4, deltaY5;
                for (let i = 0; i < count; i++) {
                    time.setTime(time.getTime() + updateInterval);
                    deltaY1 = -1 + Math.random() * (1 + 1);
                    deltaY2 = -1 + Math.random() * (1 + 1);
                    deltaY3 = -1 + Math.random() * (1 + 1);
                    deltaY4 = -1 + Math.random() * (1 + 1);
                    deltaY5 = -1 + Math.random() * (1 + 1);

                    function graph() {
                        $.ajax({
                            url: 'https://min-api.cryptocompare.com/data/pricemulti?fsyms=&tsyms=USD' + newid,
                            method: 'GET'
                        }).done(function (s) {
                            if (typeof s === 'string')
                                s = JSON.parse(s);

                            yValue1 = Math.round((yValue1 + deltaY1) * 100) / 100;
                            // pushing the new values
                            dataPoints1.push({
                                x: time.getTime(),
                                y: yValue1
                            });


                        });
                    }
                    // adding random value and rounding it to two digits. 
                    yValue2 = Math.round((yValue2 + deltaY2) * 100) / 100;
                    yValue3 = Math.round((yValue3 + deltaY3) * 100) / 100;
                    yValue4 = Math.round((yValue4 + deltaY4) * 100) / 100;
                    yValue5 = Math.round((yValue5 + deltaY5) * 100) / 100;

                    dataPoints2.push({
                        x: time.getTime(),
                        y: yValue2
                    });
                    dataPoints3.push({
                        x: time.getTime(),
                        y: yValue3
                    });
                    dataPoints4.push({
                        x: time.getTime(),
                        y: yValue4
                    });
                    dataPoints5.push({
                        x: time.getTime(),
                        y: yValue5
                    });
                }

                // updating legend text with  updated with y Value 
                options.data[0].legendText = arryofcoins[0] + ": " + yValue1 + "Wh";
                options.data[1].legendText = arryofcoins[1] + ": " + yValue2 + "Wh";
                options.data[2].legendText = arryofcoins[2] + ": " + yValue3 + "Wh";
                options.data[3].legendText = arryofcoins[3] + ": " + yValue4 + "Wh";
                options.data[4].legendText = arryofcoins[4] + ": " + yValue5 + "Wh";
                $("#chartContainer").CanvasJSChart().render();
            }
            // generates first set of dataPoints 
            updateChart(100);
            setInterval(function () { updateChart() }, updateInterval);

        }
    </script>

    <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
    <script src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script>

</body>

</html>